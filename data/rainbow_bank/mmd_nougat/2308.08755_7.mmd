## DISCUSSION 

In summary, we have presented here an efficient protocol to perform randomized measurements using metasurfaces. We demonstrated the feasibility and scalability of the approach for photonic qubits, which eliminates the need for optical setup reconfiguration. To counter the effects of realistic metasurface noise sources in generating measurement noise, we showed how to establish an effective noise model and then use this to develop a corresponding error mitigation technique that ensures the accuracy of measurement outcomes to a high fidelity. The study provides a promising approach for robust and resource-efficient photonic quantum state property estimations. 

In the current work, our primary focus was on the intrinsic noise associated with metasurfaces. This inherent noise includes unwanted diffraction and photon loss, phenomena that persist even under flawless metasurface fabrication and that typically exhibit a stochastic nature. Fabrication imperfections, on the other hand, tend to result in deviations from the desired measurement basis. It is important to note that our measurement bases are tomographically complete. This means that it is possible to calibrate the coherent measurement noise and to model its impact on the measurement outcomes, thereby facilitating the mitigation of noise induced by fabrication imperfections as well. 

Some randomized measurement protocols need nonlocal measurements. These involve state manipulation via an operation capable of generating entanglement prior to measurements [3]. However, metasurfaces are capable of achieving multi-photon interference [7], a characteristic that enables nonlocal measurements. So we expect that the schemes described in this paper can be generalized to protocols requiring nonlocal randomized measurements, such as Clifford measurement-based classical shadow of quantum states. 

In this work, we have described all necessary procedures to validate the proposed protocol with current quantum photonic technologies. We expect that experimental implementation with small numbers of photons is readily implementable and could lead to additional refinements and extensions of the protocol as metasurface noise calibration is implemented in practice on real systems. 

## ACKNOWLEDGEMENTS 

The authors thank Ying Li for valuable discussions. ZZ acknowledges the support from the Royal Society scholarship. LX and MR acknowledge support from the UK Research and Innovation Future Leaders Fellowship (MR/T040513/1). YP, HR, and KBW were supported by the U.S. Department of Energy, Office of Science, National Quantum Information Science Research Centers, and Quantum Systems Accelerator. H 

## DESIGN AND CHARACTERIZATION OF METASURFACE 

The guiding principle in our metasurface design is to create a metasurface that projects photons under randomly chosen basis pairs of H/V, H \(\pm\)V, LC/RC. Our design involves a metasurface composed of periodic Si nanodisks, the parameters of which are tuned to optimize measurement efficiency. We use numerical simulations to assist the metasurface design. 

For an incident wavelength of 1550nm as an example, the nanodisks are designed to have a height \(h_{0}=800\)nm and periodicity \(p_{0}=800\)nm. We then scan the width and depth of the nanodisks along the x- ( \(D_{x}\)) and yaxes ( \(D_{y}\)), calculating the corresponding optical properties of the metasurfaces. Fig. 6 displays the transmission and phase change spectra under x- and y-polarised plane waves while altering the width and depth of the nanodisks. The design of nanodisks is optimized to enhance both transmission rate and phase change. Due to the excitations of Mie-type electric and magnetic dipole resonances within the nanodisks and their interference, the backward scattering is strongly suppressed, leading to distinct phase changes along the x and y axes and forming a birefringent film with high transmission. 

In order to separate photons with opposite polarization into +1 and -1 diffraction orders, we leverage the spatial linear dependence of the geometric phase on the transverse position of metagratings (along the x-axis). We utilize the genetic algorithm (AGA) to carefully select the geometric parameters of each unit to arrange a gradient phase distribution of two orthogonal states ( \(\varphi_{1}\) and \(\varphi_{2}\)) along the x-axis with high transmission. The unit size is 750 \(\times\) 800 nm. Eventually, we successfully designed metagratings that can separate three pairs of orthogonal states (HV, H \(\pm\)V, and RCLC), illuminating into different angles with 4 \(\times\)1, 5 \(\times\)1, and 6 \(\times\)1 meta-atoms as periodic units (as shown in the figure). By assembling these metagratings, we can form metasurfaces that distinguish three pairs of orthogonal states into different diffractive angles, leading to six ports for the characterization of quantum states (as shown in Fig. 1c). 

The detailed parameters of the metasurface design are listed in Table I. Given the current experimental capabilities, it is feasible to fabricate a metasurface with these parameters. With this design, we numerically characterize the measurement efficiency, as shown in Table II. The data used for noise calibration are listed in Table III, and the calibrated noise rate can be found in Table IV. 

The transmission and phase change spectra, obtained while adjusting the width and depth of the nanodisk, are calculated using Rigorous Coupled-Wave Analysis (RCWA) [27]. RCWA is a frequency-domain modal method based on the decomposition of a periodic structure and the pseudoperiodic solution of Maxwellâ€™s equations in terms of their Fourier expansions [28]. 

The optical properties of metagratings are computed using the finite element method via COMSOL Multi